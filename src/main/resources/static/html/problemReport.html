<!DOCTYPE html>
<html>
<head>
<title>问题统计</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta charset="UTF-8">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" href="../jsPackage/layui-v2.4.2/css/layui.css">
<link rel="stylesheet" href="../css/report.css" media="all">
</head>
<body>
	<div class="layui-fluid " style="overflow: visible">
		<!-- 搜索条件 -->
		<div class="layui-row layui-col-space15">
			<div class="layui-col-md12 ">
				<fieldset>
					<legend>查询条件</legend>
					<form class="layui-form" action="">
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label head-text">开始日期:</label>
								<div class="layui-input-inline">
									<input type="text" class="layui-input " id="startTime"
										placeholder="yyyy-mm-dd" style="width: 100px">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label head-text">截至日期:</label>
								<div class="layui-input-inline">
									<input type="text" class="layui-input " id="endTime"
										placeholder="yyyy-mm-dd" style="width: 100px">
								</div>
							</div>
							<div class="layui-inline" id="generateTestData">
									<i class="layui-icon">&#xe615;</i> 查询
							</div>
						</div>
					</form>
				</fieldset>
			</div>
		</div>

		<!-- 显示数据 -->
		<div class="layui-row layui-col-space20">
			<div class="layui-col-md4 complate-rate " style="height: 300px">

			</div>
			<div class="layui-col-md8 complate-show" style="height: 300px">

			</div>
			<div class="layui-col-md12" style="height:360px">
				<table class="layui-table" id="problemReport" lay-filter="problemReport">

				</table>
			</div>
		</div>

	</div>
	<script type="text/javascript" src="../jsPackage/layui-v2.4.2/layui.js"></script>
	<script type="text/javascript" src="../jsPackage/echarts/echarts.min.js"></script>
	<script type="text/javascript">
	layui.use(['jquery','table','form','laydate','table'], function(){
			var layer = layui.layer,form = layui.form,
				$ = layui.$, //重点处,使用jQuery
				laydate = layui.laydate,table=layui.table;
			console.log(layer);
			function renderTime(param){
				laydate.render({
					elem: param,
					type: 'date',
					trigger: 'click' //采用click弹出
				});
			};

			renderTime('#startTime');
			renderTime('#endTime');
			form.render(); 
			//表格数据
			var tableData={
					  "code": 0
					  ,"msg": ""
					  ,"count": 1
					  ,"data": [{
					    "jc-total":0
					    ,"jc-finished": 0
					    ,"jc-unfinished": 0
						,"wx-total":0
						,"wx-finished": 0
						,"wx-unfinished": 0
						,"hse-total":0
						,"hse-finished": 0
						,"hse-unfinished": 0
						,"sb-total":0
						,"sb-finished": 0
						,"sb-unfinished": 0
						,"zh-total":0
						,"zh-finished": 0
						,"zh-unfinished": 0
						,"cw-total":0
						,"cw-finished": 0
						,"cw-unfinished": 0
						,"sc-total":0
						,"sc-finished": 0
						,"sc-unfinished": 0
					  }]};
			//统计问题情况
			function changeTableDate(para,area){
				if(para.PROBLEMSTATE=='UNFINISHED'){
					tableData.data[0]["'"+area+"-unfinished'"]+=parseInt(para.count);
				}else{
					tableData.data[0]["'"+area+"-finished'"]+=parseInt(para.count);
				}
					tableData.data[0]["'"+area+"-total'"]+=parseInt(para.count);
			}
			$("#generateTestData").click(function(){
				var total=0, finished=0;
				$.getJSON('/iot_process/report/problemCount',{'beginTime':$('#startTime').val(),'endTime':$('#endTime').val()},function(aj){
					if(aj.state==0){
						var useData=aj.data;
						//根据获取的数据进行分析
						$.each(useData,function(i,n){
							total+=parseInt(n.count);
							if(n.PROBLEMSTATE=='FINISHED'){
								finished+=parseInt(n.count);
							};
							switch (n.area){
							case '净化工段':
								changeTableDate(n.PROBLEMSTATE,'jc');
								break;
							case '维修工段':
								changeTableDate(n.PROBLEMSTATE,'wx');
								break;
							case 'HSE办公室':
								changeTableDate(n.PROBLEMSTATE,'hse');
								break;
							case '财务经营办公室':
								changeTableDate(n.PROBLEMSTATE,'cw');
								break;
							case '设备办':
								changeTableDate(n.PROBLEMSTATE,'sb');
								break;
							case '生产办':
								changeTableDate(n.PROBLEMSTATE,'sc');
								break;
							case '综合办':
								changeTableDate(n.PROBLEMSTATE,'zh');
								break;
							}
						});
						console.log(aj.data);
					}
				})
			});
			var option = {
				    tooltip : {
				        formatter: "{a} <br/>{c} {b}"
				    },
				    backgroundColor: '#0f375f',
				    toolbox: {
				        show: true,
				        feature: {
				            restore: {show: true},
				            saveAsImage: {show: true}
				        }
				    },
				    grid:{
				    	top:2,
				    	right:2,
				    	left:2,
				    	bottom:2},
				    series : [
				        {
				            name: '速度',
				            type: 'gauge',
				            z: 3,
				            min: 0,
				            max: 100,
				            splitNumber: 10,
				            radius: '95%',
				            axisLine: {            // 坐标轴线
				                lineStyle: {       // 属性lineStyle控制线条样式
				                    width: 10
				                }
				            },
				            axisTick: {            // 坐标轴小标记
				                length: 15,        // 属性length控制线长
				                lineStyle: {       // 属性lineStyle控制线条样式
				                    color: 'auto'
				                }
				            },
				            splitLine: {           // 分隔线
				                length: 20,         // 属性length控制线长
				                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
				                    color: 'auto'
				                }
				            },
				            axisLabel: {
				                backgroundColor: 'auto',
				                borderRadius: 2,
				                color: '#eee',
				                padding: 3,
				                textShadowBlur: 2,
				                textShadowOffsetX: 1,
				                textShadowOffsetY: 1,
				                textShadowColor: '#222'
				            },
				            title : {
				                // 其余属性默认使用全局文本样式，详见TEXTSTYLE
				                top:60,
				                fontWeight: 'bolder',
				                fontSize: 20,
				                fontStyle: 'italic'
				            },
				            detail : {
				                // 其余属性默认使用全局文本样式，详见TEXTSTYLE
				                formatter: function (value) {
				                    value = (value + '').split('.');
				                    value.length < 2 && (value.push('00'));
				                    return ('00' + value[0]).slice(-2)
				                        + '.' + (value[1] + '00').slice(0, 2);
				                },
				                fontWeight: 'bolder',
				                borderRadius: 3,
				                backgroundColor: '#444',
				                borderColor: '#aaa',
				                shadowBlur: 5,
				                shadowColor: '#333',
				                shadowOffsetX: 0,
				                shadowOffsetY: 3,
				                borderWidth: 2,
				                textBorderColor: '#000',
				                textBorderWidth: 2,
				                textShadowBlur: 2,
				                textShadowColor: '#fff',
				                textShadowOffsetX: 0,
				                textShadowOffsetY: 0,
				                fontFamily: 'Arial',
				                width: 60,
				                color: '#eee',
				                rich: {}
				            },
				            data:[{value: 40, name: '完成率'}]
				        }
				       
				    ]
				};
			var myChart = echarts.init($('.complate-rate')[0]);
			myChart.setOption(option);
			var category = [];
			var dottedBase = +new Date();
			var lineData = [];
			var barData = [];

			for (var i = 0; i < 20; i++) {
			    var date = new Date(dottedBase += 3600 * 24 * 1000);
			    category.push([
			        date.getFullYear(),
			        date.getMonth() + 1,
			        date.getDate()
			    ].join('-'));
			    var b = Math.random() * 200;
			    var d = Math.random() * 200;
			    barData.push(b)
			    lineData.push(d + b);
			}
			var Baroption = {
				   grid:{
				    	top:30,
				    	right:30,
				    	left:30,
				    	bottom:30},
				    backgroundColor: '#0f375f',
				    tooltip: {
				        trigger: 'axis',
				        axisPointer: {
				            type: 'shadow'
				        }
				    },
				    legend: {
				        data: ['line', 'bar'],
				        textStyle: {
				            color: '#ccc'
				        }
				    },
				    xAxis: {
				        data: category,
				        axisLine: {
				            lineStyle: {
				                color: '#ccc'
				            }
				        }
				    },
				    yAxis: {
				        splitLine: {show: false},
				        axisLine: {
				            lineStyle: {
				                color: '#ccc'
				            }
				        }
				    },
				    series: [ {
				        name: 'bar',
				        type: 'bar',
				        barWidth: 10,
				        itemStyle: {
				            normal: {
				                barBorderRadius: 5,
				                color: new echarts.graphic.LinearGradient(
				                    0, 0, 0, 1,
				                    [
				                        {offset: 0, color: '#14c8d4'},
				                        {offset: 1, color: '#43eec6'}
				                    ]
				                )
				            }
				        },
				        data: barData
				    }, {
				        name: 'dotted',
				        type: 'pictorialBar',
				        symbol: 'rect',
				        itemStyle: {
				            normal: {
				                color: '#0f375f'
				            }
				        },
				        symbolRepeat: true,
				        symbolSize: [12, 4],
				        symbolMargin: 1,
				        z: -10,
				        data: lineData
				    }]
				};
			var myChart1 = echarts.init($('.complate-show')[0]);
			myChart1.setOption(Baroption);
			table.render({
			    elem: '#problemReport'
			    ,title: '问题统计表'
			    ,cols: [[
			      ,{ title:'净化工段',colspan:3,align:'center'}
			      ,{ title:'维修工段',colspan:3,align:'center'}
			      ,{ title:'HSE办',colspan:3,align:'center'}
			      ,{ title:'生产办',colspan:3,align:'center'}
			      ,{ title:'设备办',colspan:3,align:'center'}
			      ,{ title:'综合办',colspan:3,align:'center'}
			      ,{ title:'财务办',colspan:3,align:'center'}
			    ],[
				      {field:'jc-total', title:'总量'}
				      ,{field:'jc-finished', title:'已整改',minWidth:75}
				      ,{field:'jc-unfinished', title:'未整改',minWidth:75}
				      ,{field:'wx-total', title:'总量'}
				      ,{field:'wx-finished', title:'已整改',minWidth:75}
				      ,{field:'wx-unfinished', title:'未整改',minWidth:75}
				      ,{field:'hse-total', title:'总量'}
				      ,{field:'hse-finished', title:'已整改',minWidth:75}
				      ,{field:'hse-unfinished', title:'未整改',minWidth:75}
				      ,{field:'sc-total', title:'总量'}
				      ,{field:'sc-finished', title:'已整改',minWidth:75}
				      ,{field:'sc-unfinished', title:'未整改',minWidth:75}
				      ,{field:'sb-total', title:'总量'}
				      ,{field:'sb-finished', title:'已整改',minWidth:75}
				      ,{field:'sb-unfinished', title:'未整改',minWidth:75}
				      ,{field:'zh-total', title:'总量'}
				      ,{field:'zh-finished', title:'已整改',minWidth:75}
				      ,{field:'zh-unfinished', title:'未整改',minWidth:75}
				      ,{field:'cw-total', title:'总量'}
				      ,{field:'cw-finished', title:'已整改',minWidth:75}
				      ,{field:'cw-unfinished', title:'未整改',minWidth:75}
			    ]]
			    ,page: true
			  });
		});		 
	</script>
</body>
</html>
